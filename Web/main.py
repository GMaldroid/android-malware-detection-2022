import os
import time
import streamlit as st
from android import Android


if __name__ == '__main__':
    android = Android()
    st.set_page_config(page_title='APK Malware Detection')
    st.sidebar.image('static/images/LogoHVKTMM.png')
    st.sidebar.title("Upload APK File")
    # st.set_option('deprecation.showfileUploaderEncoding', False)
    uploaded_file = st.sidebar.file_uploader(" ")
    if uploaded_file:
        with open(f'/tmp/{uploaded_file.name}', "wb") as f:
            f.write(uploaded_file.getbuffer())
        start_decompile = time.time()
        os.system(f"apktool d /tmp/{uploaded_file.name} -o /tmp/decompile -f")
        end_decompile = time.time()
        st.success(f"Completely saved and decompiled, {end_decompile - start_decompile:.2f}s")
        st.success(android.predict('/tmp/decompile'))
        # print(create_app_api_vector(extract_api(api_names, '/tmp/decompile')).shape)

        # start = time.time()
        # print(f'{time.strftime("%d-%m-%Y:%H:%M:%S")} - {uploaded_file.name} - {model.predict(app_decompile)[0]}')
        # end = time.time()
        # st.write(f'Time create feature vector and predict: {end - start}')
    else:
        st.sidebar.write("Please upload an apk file")
