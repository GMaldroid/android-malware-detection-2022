import os
import time
import streamlit as st
from android import Android


if __name__ == '__main__':
    android = Android()
    st.set_page_config(page_title='APK Malware Detection')
    st.sidebar.image('static/images/LogoHVKTMM.png')
    st.sidebar.title("Upload APK File")
    # st.set_option('deprecation.showfileUploaderEncoding', False)
    uploaded_file = st.sidebar.file_uploader(" ")
    if uploaded_file:
        with open(f'/tmp/{uploaded_file.name}', "wb") as f:
            f.write(uploaded_file.getbuffer())
        start_decompile = time.time()
        os.system(f"apktool d /tmp/{uploaded_file.name} -o /tmp/decompile -f")
        end_decompile = time.time()
        st.success(f"Completely saved and decompiled, {end_decompile - start_decompile:.2f}s")

        start_predict = time.time()
        st.success(f"Predicted label: {android.predict('/tmp/decompile', st)}")
        end_predict = time.time()
        st.success(f"Completely predicted, {end_predict - start_predict:.2f}s")
    else:
        st.sidebar.write("Please upload an apk file")
